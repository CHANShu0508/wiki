(window.webpackJsonp=window.webpackJsonp||[]).push([[50],{460:function(s,t,a){"use strict";a.r(t);var n=a(20),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h2",{attrs:{id:"点亮led"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#点亮led"}},[s._v("#")]),s._v(" 点亮LED")]),s._v(" "),a("h3",{attrs:{id:"对-cubemx的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对-cubemx的配置"}},[s._v("#")]),s._v(" 对 CubeMX的配置")]),s._v(" "),a("p",[s._v("对应LED三色光的分别是 PH11, PH12 和 PH13，在设定的时候对其进行更改，"),a("code",[s._v("OUTPUT")]),s._v("模式是必然的，而对于GPIO 的配置也很关键：")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/CHANShu0508/images_shack/images/20200823170415.png"}})]),s._v(" "),a("p",[s._v("如图：三个引脚均为此配置。推挽输出、强电流是常用的模式，但是为什么要在这个地方使用上拉电阻呢？")]),s._v(" "),a("p",[s._v("首先回答这个问题，由于这种"),a("strong",[s._v("弱上拉")]),s._v("对输出起到的作用很微小，不能影响其输出高低电位，而其仅有的两个作用则是：（至于这两个特性如何体现，请往下读）")]),s._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[s._v("上下拉对输出的作用")]),s._v(" "),a("ul",[a("li",[a("p",[a("strong",[s._v("提高驱动能力")])]),s._v(" "),a("p",[s._v("例如，用单片机输出高电平，但由于后续电路的影响，输出的高电平不高，就是达不到VCC，影响电路工作。所以要接上拉电阻。下拉电阻情况相反，让单片机引脚输出低电平，结果由于后续电路影响输出的低电平达不到GND，所以接个下拉电阻。")])]),s._v(" "),a("li",[a("p",[a("strong",[s._v("在单片机引脚电平不定的时候, 让后面有一个稳定的电平")])]),s._v(" "),a("p",[s._v("例如上面接下拉电阻的情况下，在单片机刚上电的时候，电平是不定的，还有就是如果你连接的单片机在上电以后，单片机引脚是输入引脚而不是输出引脚，那这时候的单片机电平也是不定的，R18的作用就是如果前面的单片机引脚电平不定的话，强制让电平保持在低电平。")])])])]),s._v(" "),a("p",[s._v("而需要了解的则是在Robomaster C板中 LED 本身有的一个下拉电阻：")]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/CHANShu0508/images_shack/images/20200823172549.png"}})]),s._v(" "),a("p",[s._v("由于 GPIO 本身的输出电流是很低的，所以采取外接电源的方式供电 LED。对于三极管，它的作用就是利用 IO 口输出电平的高低决定线路的通断，而红圈圈出的下拉电阻作用很大：")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("在输出低电平的时候，将控制级的点位下拉接地")])]),s._v(" "),a("li",[a("p",[s._v("在输出高电平的时候，起分压作用防止控制级电位过低")]),s._v(" "),a("p",[s._v("还记得刚刚提到的上拉电阻的弱上拉作用吗，为了"),a("strong",[s._v("防止输出的电压过低达不到要求")]),s._v("，所以此处 GPIO 也设置为上拉"),a("code",[s._v("pull-up")])])])]),s._v(" "),a("p",[s._v("还有一点就是对于 IO 口的命名，命名的话在生成的工程中也会有一个定义：")]),s._v(" "),a("ul",[a("li",[s._v("如原来的"),a("code",[s._v("GPIOH")]),s._v("，在命名后就是"),a("code",[s._v("LED_R_GPIO_PORT")]),s._v("也就是会在"),a("code",[s._v("LED_R")]),s._v("后面加上一个"),a("code",[s._v("_GPIO_PORT")]),s._v("，但是为了同意组号，还是使用"),a("code",[s._v("GPIOH")]),s._v("比较好")]),s._v(" "),a("li",[s._v("IO 口就更简单，就是在"),a("code",[s._v("LED_R")]),s._v("之后加上"),a("code",[s._v("_PIN")]),s._v("即"),a("code",[s._v("LED_R_PIN")]),s._v("，使用 IO 口的名称将会便于阅读程序")])]),s._v(" "),a("h3",{attrs:{id:"实现代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#实现代码"}},[s._v("#")]),s._v(" 实现代码")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//set GPIO output high level")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HAL_GPIO_WritePin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LED_R_GPIO_Port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LED_R_Pin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" GPIO_PIN_SET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HAL_GPIO_WritePin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LED_G_GPIO_Port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LED_G_Pin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" GPIO_PIN_SET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HAL_GPIO_WritePin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LED_B_GPIO_Port"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LED_B_Pin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" GPIO_PIN_SET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[s._v("详细的函数说明请见"),a("RouterLink",{attrs:{to:"/pages/67ee08/#hal-gpio-writepin"}},[s._v("这里")]),s._v("，这个操作就是将三原色的灯都点亮，LED 显示白色。")],1),s._v(" "),a("h2",{attrs:{id:"闪烁-延时"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#闪烁-延时"}},[s._v("#")]),s._v(" 闪烁—延时")]),s._v(" "),a("p",[s._v("为了实现 LED 可以闪烁而不是一直亮着，我们需要对程序延时，达到这一目的可以使用自定义或自带函数两种方法：")]),s._v(" "),a("h3",{attrs:{id:"自定义延时函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义延时函数"}},[s._v("#")]),s._v(" 自定义延时函数")]),s._v(" "),a("p",[s._v("自定义延时函数也有两种方法：")]),s._v(" "),a("p",[a("strong",[s._v("第一种方法")]),s._v("是执行嵌套的空"),a("code",[s._v("for")]),s._v("语句达到延时的目的：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("user_delay_us")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v(" us"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" us "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" us"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint8_t")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Empty loop body")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br")])]),a("p",[s._v("这个函数可以实现毫秒级（1ms = 1000μs）的延时，如果想用这样的方式实现微秒级的延时可以定义函数"),a("code",[s._v("user_delay_ms")]),s._v("，调用微秒级的延时函数，并将参数设为1000即可：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("user_delay_ms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v(" ms"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" ms "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" ms"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("user_delay_us")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("p",[a("strong",[s._v("第二种方法")]),s._v("则是通过执行空指令"),a("code",[s._v("_nop()")]),s._v("来实现的：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("nop_delay_us")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint16_t")]),s._v(" us"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" us "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" us"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint8_t")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n            "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("_nop")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br")])]),a("p",[s._v("这个也会实现毫秒级的延时，如果要实现微秒级，方法与上面相同；")]),s._v(" "),a("h3",{attrs:{id:"库函数"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#库函数"}},[s._v("#")]),s._v(" 库函数")]),s._v(" "),a("p",[s._v("就是函数"),a("code",[s._v("HAL_Delay()")]),s._v("关于它本身不再多说，请见"),a("RouterLink",{attrs:{to:"/pages/67ee08/#hal-delay"}},[s._v("这里")]),s._v("。而我们要了解它背后是什么：")],1),s._v(" "),a("p",[s._v("我们需要简要的介绍一下"),a("strong",[s._v("滴答计时器")]),s._v("（SysTick）：")]),s._v(" "),a("p",[s._v("在"),a("code",[s._v("main")]),s._v("函数中有一个"),a("code",[s._v("HAL_INIT()")]),s._v("，在这这个函数中STM32实现了 SysTick 以及底层硬件的初始化。对 SysTick 的初始化为："),a("code",[s._v("HAL_InitTick(TICK_INT_PRIORITY)")]),s._v("，这个函数将设定 SysTick 的定时周期为1ms，即频率为1000Hz，并使SysTick开始工作。每当滴答计时器递减到 0 时，会触发中断，使程序进入SysTick中断处理函数"),a("code",[s._v("SysTick_Handler(void)")]),s._v("，这个函数中又只会调用"),a("code",[s._v("HAL_IncTick()")]),s._v("函数，其内容是：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[s._v("__weak "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HAL_IncTick")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    uwTick "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+=")]),s._v(" uwTickFreq"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("由于每个1ms的中断都会为"),a("code",[s._v("uwTick")]),s._v("加上1ms的值，所以"),a("code",[s._v("uwTick")]),s._v("变量中存储的是从STM32的 Systick 初始化以来所经过的时间（ms），"),a("code",[s._v("uwTick")]),s._v("的存在相当于给整个程序提供了一个绝对的时间基准，而"),a("code",[s._v("HAL_Delay()")]),s._v("函数延时功能便是通过uwTick的值完成的")]),s._v(" "),a("p",[s._v("如果想要在你的程序中也访问"),a("code",[s._v("uwTick")]),s._v("的值，可以使用"),a("RouterLink",{attrs:{to:"/pages/67ee08/#hal-gettick"}},[a("code",[s._v("HAL_GetTick()")])]),s._v("函数")],1),s._v(" "),a("p",[a("code",[s._v("HAL_Delay()")]),s._v("的优点是不用我们自己去自定义，而缺点在于只能到毫秒级")]),s._v(" "),a("h2",{attrs:{id:"底层"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#底层"}},[s._v("#")]),s._v(" 底层")]),s._v(" "),a("h3",{attrs:{id:"gpio外设结构体"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gpio外设结构体"}},[s._v("#")]),s._v(" GPIO外设结构体")]),s._v(" "),a("p",[s._v("HAL 库为每个外设(GPIO 除外)创建了两个结构体，一个是"),a("strong",[s._v("外设初始化结构体")]),s._v("，一个是"),a("strong",[s._v("外设句柄结构体")]),s._v("，其中 GPIO 没有句柄结构体。这两个结构体都是定义在外设对应的驱动头文件中，比如"),a("code",[s._v("stm32f4xx_hal_usart.h")]),s._v(" 文件。")]),s._v(" "),a("p",[s._v("初始化结构一般是做为句柄结构体的一个成员通过指针被引用，而句柄结构体则在外设 HAL 函数库实现被使用，比如在"),a("code",[s._v("stm32f4xx_hal_usart.c")]),s._v(" 文件。这两个结构体内容几乎包括了外设的所有可选属性，理解这两个结构体内容对我们编程非常有帮助。\nGPIO 外设只有一个初始化结构体，没有句柄结构体，所以 GPIO 初始化结构体直接在"),a("code",[s._v("stm32f4xx_hal_gpio.c")]),s._v("文件中与相关初始化函数配合使用完成 GPIO 外设初始化配置")]),s._v(" "),a("p",[s._v("其代码如下：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("typedef")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("struct")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("02")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v(" Pin"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*GPIO 引脚编号选择 */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("03")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v(" Mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*GPIO 引脚工作模式 */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("04")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v(" Pull"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*GPIO 引脚上拉、下拉配置 */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("05")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v(" Speed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*GPIO 引脚最大输出速度 */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("06")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("uint32_t")]),s._v(" Alternate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*GPIO 引脚的复用 */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("07")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" GPIO_InitTypeDef"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("h3",{attrs:{id:"对gpio编程的流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#对gpio编程的流程"}},[s._v("#")]),s._v(" 对GPIO编程的流程")]),s._v(" "),a("p",[s._v("如果使用 CubeMX 直接生成代码的话，这些过程是直接被省略的，但是为了深入理解它到底是如何工作的，我们还是来学习一下：")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("首先需要定义一个硬件初始化结构体：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[s._v("GPIO_InitTypeDef GPIO_InitStruct"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("有标准库那味儿了吧")])]),s._v(" "),a("li",[a("p",[s._v("随后需要开启 LED 对应引脚对应的 IO 端口时钟：")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("__HAL_RCC_GPIOx_CLK_ENABLE")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("设置对应引脚首先输出低电位")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HAL_GPIO_WritePin")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LED1_GPIO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" LED1_GPIO_PIN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" GPIO_PIN_RESET"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("初始化结构体内参数")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 设定LED1 对应引脚IO 编号 */")]),s._v("\nGPIO_InitStruct"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Pin "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" LED1_GPIO_PIN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 设定LED1 对应引脚IO 为输出模式 */")]),s._v("\nGPIO_InitStruct"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Mode "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" GPIO_MODE_OUTPUT_PP"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 设定LED1 对应引脚IO 操作速度 */")]),s._v("\nGPIO_InitStruct"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Speed "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" GPIO_SPEED_FREQ_LOW"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 初始化LED1 对应引脚IO */")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HAL_GPIO_Init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LED1_GPIO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("GPIO_InitStruct"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br")])])]),s._v(" "),a("li",[a("p",[s._v("配置到硬件")]),s._v(" "),a("div",{staticClass:"language-c line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-c"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("HAL_GPIO_Init")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("LED3_GPIO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("GPIO_InitStruct"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])]),s._v(" "),a("div",{attrs:{align:"center"}},[a("img",{attrs:{src:"https://cdn.jsdelivr.net/gh/CHANShu0508/images_shack/images/20200930205422.png"}})]),s._v(" "),a("h2",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),a("p",[s._v("[1] Robomaster 开发板C型教程")]),s._v(" "),a("p",[s._v("[2] HAL 用户手册")]),s._v(" "),a("p",[s._v("[3] 硬石科技 YS-F4Pro 开发手册")])])}),[],!1,null,null,null);t.default=e.exports}}]);