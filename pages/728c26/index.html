<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>STM32的运行 | Wiki：知识&amp;笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/img/header32.png">
    <meta name="description" content="不再碎片化 | No longer fragmented">
    <meta name="keywords" content="个人技术博客,技术文档,学习,git,github,markdown,嵌入式,STM32,C语言">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.57c10a4d.css" as="style"><link rel="preload" href="/assets/js/app.287ba006.js" as="script"><link rel="preload" href="/assets/js/2.cf4362eb.js" as="script"><link rel="preload" href="/assets/js/41.8cb7036a.js" as="script"><link rel="prefetch" href="/assets/js/10.ca3f9f94.js"><link rel="prefetch" href="/assets/js/11.b4d1c50f.js"><link rel="prefetch" href="/assets/js/12.cca3ba79.js"><link rel="prefetch" href="/assets/js/13.e1d72f62.js"><link rel="prefetch" href="/assets/js/14.91f2adb6.js"><link rel="prefetch" href="/assets/js/15.a7a70068.js"><link rel="prefetch" href="/assets/js/16.d5be4432.js"><link rel="prefetch" href="/assets/js/17.31ec0952.js"><link rel="prefetch" href="/assets/js/18.8c0f4835.js"><link rel="prefetch" href="/assets/js/19.7cbc9836.js"><link rel="prefetch" href="/assets/js/20.e1ca69ed.js"><link rel="prefetch" href="/assets/js/21.b3b61477.js"><link rel="prefetch" href="/assets/js/22.03aa72ee.js"><link rel="prefetch" href="/assets/js/23.564ba096.js"><link rel="prefetch" href="/assets/js/24.cf195300.js"><link rel="prefetch" href="/assets/js/25.0d959a77.js"><link rel="prefetch" href="/assets/js/26.8f179dd3.js"><link rel="prefetch" href="/assets/js/27.9d4841cf.js"><link rel="prefetch" href="/assets/js/28.5c175096.js"><link rel="prefetch" href="/assets/js/29.2cb763ad.js"><link rel="prefetch" href="/assets/js/3.92b0bd34.js"><link rel="prefetch" href="/assets/js/30.eaf25d81.js"><link rel="prefetch" href="/assets/js/31.7f3c2787.js"><link rel="prefetch" href="/assets/js/32.abd8deb1.js"><link rel="prefetch" href="/assets/js/33.6c0ca3cd.js"><link rel="prefetch" href="/assets/js/34.2357e103.js"><link rel="prefetch" href="/assets/js/35.bedfc4ca.js"><link rel="prefetch" href="/assets/js/36.1fe9624d.js"><link rel="prefetch" href="/assets/js/37.6c24fb08.js"><link rel="prefetch" href="/assets/js/38.f00e5f04.js"><link rel="prefetch" href="/assets/js/39.5064abfe.js"><link rel="prefetch" href="/assets/js/4.9907f1e1.js"><link rel="prefetch" href="/assets/js/40.a7bfeb29.js"><link rel="prefetch" href="/assets/js/42.b5ed0c1b.js"><link rel="prefetch" href="/assets/js/43.29bf753c.js"><link rel="prefetch" href="/assets/js/44.a2888a8b.js"><link rel="prefetch" href="/assets/js/45.26d4fffe.js"><link rel="prefetch" href="/assets/js/46.59abb034.js"><link rel="prefetch" href="/assets/js/47.910b85e1.js"><link rel="prefetch" href="/assets/js/48.afbe4f62.js"><link rel="prefetch" href="/assets/js/49.a134584b.js"><link rel="prefetch" href="/assets/js/5.d0ed1372.js"><link rel="prefetch" href="/assets/js/50.3a7461e2.js"><link rel="prefetch" href="/assets/js/51.9575cb04.js"><link rel="prefetch" href="/assets/js/52.5fd5937b.js"><link rel="prefetch" href="/assets/js/53.d9b43790.js"><link rel="prefetch" href="/assets/js/54.4dd21ee3.js"><link rel="prefetch" href="/assets/js/55.6387d56f.js"><link rel="prefetch" href="/assets/js/56.05dd9dca.js"><link rel="prefetch" href="/assets/js/57.06ef5d9e.js"><link rel="prefetch" href="/assets/js/58.22dcffa8.js"><link rel="prefetch" href="/assets/js/59.f6f581db.js"><link rel="prefetch" href="/assets/js/6.e89ddaa7.js"><link rel="prefetch" href="/assets/js/60.608fdff0.js"><link rel="prefetch" href="/assets/js/61.ca910a34.js"><link rel="prefetch" href="/assets/js/62.40a51140.js"><link rel="prefetch" href="/assets/js/63.939ad5ab.js"><link rel="prefetch" href="/assets/js/64.fb28b271.js"><link rel="prefetch" href="/assets/js/65.4d6df1bd.js"><link rel="prefetch" href="/assets/js/66.0063edc7.js"><link rel="prefetch" href="/assets/js/67.bfd086a1.js"><link rel="prefetch" href="/assets/js/7.3cc1b487.js"><link rel="prefetch" href="/assets/js/8.3c2658fb.js"><link rel="prefetch" href="/assets/js/9.e346ca1c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.57c10a4d.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/head.png" alt="Wiki：知识&amp;笔记" class="logo"> <span class="site-name can-hide">Wiki：知识&amp;笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言学习" class="dropdown-title"><a href="/languages/" class="link-title">语言学习</a> <span class="title" style="display:none;">语言学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><a href="/basicknowledge/" class="link-title">基础知识</a> <span class="title" style="display:none;">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>嵌入式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/basicknowledge/stm32/" class="nav-link">STM32</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/others/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/9a7ee40fc232253e/" class="nav-link">技术文档</a></li></ul></div></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/chanshu0508/wikiBase" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="语言学习" class="dropdown-title"><a href="/languages/" class="link-title">语言学习</a> <span class="title" style="display:none;">语言学习</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/javascript/" class="nav-link">《JavaScript教程》笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><a href="/basicknowledge/" class="link-title">基础知识</a> <span class="title" style="display:none;">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>嵌入式</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/basicknowledge/stm32/" class="nav-link">STM32</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><a href="/others/" class="link-title">其他</a> <span class="title" style="display:none;">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/others/9a7ee40fc232253e/" class="nav-link">技术文档</a></li></ul></div></div><div class="nav-item"><a href="/archives/" class="nav-link">归档</a></div> <a href="https://github.com/chanshu0508/wikiBase" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/a7a186/" class="sidebar-link">资源索引</a></li><li><a href="/pages/be9c1f/" class="sidebar-link">STM32 命名</a></li><li><a href="/pages/1c5e9d/" class="sidebar-link">硬件简要介绍</a></li><li><a href="/pages/25d378/" class="sidebar-link">MCU的硬件运行机制</a></li><li><a href="/pages/728c26/" aria-current="page" class="active sidebar-link">STM32的运行</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/728c26/#主线的运行-主线仲裁" class="sidebar-link">主线的运行：主线仲裁</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/728c26/#几条总控总线" class="sidebar-link">几条总控总线</a></li><li class="sidebar-sub-header"><a href="/pages/728c26/#什么是总线矩阵" class="sidebar-link">什么是总线矩阵</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/728c26/#地址映射与位带操作" class="sidebar-link">地址映射与位带操作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/728c26/#地址映射" class="sidebar-link">地址映射</a></li><li class="sidebar-sub-header"><a href="/pages/728c26/#位带操作" class="sidebar-link">位带操作</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/728c26/#时钟与复位" class="sidebar-link">时钟与复位</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/728c26/#时钟的生成" class="sidebar-link">时钟的生成</a></li><li class="sidebar-sub-header"><a href="/pages/728c26/#外设时钟的配置" class="sidebar-link">外设时钟的配置</a></li><li class="sidebar-sub-header"><a href="/pages/728c26/#主时钟的输出" class="sidebar-link">主时钟的输出</a></li></ul></li></ul></li><li><a href="/pages/c885ad/" class="sidebar-link">一些语言&amp;调试零碎</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>底层&amp;寄存器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HAL库外设</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-33863c7e><div class="articleInfo" data-v-33863c7e><ul class="breadcrumbs" data-v-33863c7e><li data-v-33863c7e><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-33863c7e></a></li> <li data-v-33863c7e><a href="/basicknowledge/stm32" title="STM32-目录页" data-v-33863c7e>STM32</a></li> <li data-v-33863c7e><a href="/basicknowledge/stm32/#基础" title="STM32#基础" data-v-33863c7e>基础</a></li> <!----></ul> <div class="info" data-v-33863c7e><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-33863c7e><a href="javascript:;" data-v-33863c7e>2020-09-25</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">
          STM32的运行
        </h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="主线的运行-主线仲裁"><a href="#主线的运行-主线仲裁" class="header-anchor">#</a> 主线的运行：主线仲裁</h2> <blockquote><p>这里讲到的总线是片外的外部总线：指令、数据与系统总线</p></blockquote> <p>还是从这张图开始：</p> <img src="https://cdn.jsdelivr.net/gh/CHANShu0508/images_shack/images/20200814235406.png" alt="sructure" style="zoom:80%;"> <p>其中的<strong>Bus Matrix</strong>也就是总线矩阵可以调用循环调度算法从而实现总线仲裁的功能：</p> <div align="center"><img src="https://cdn.jsdelivr.net/gh/CHANShu0508/images_shack/images/20200928211015.jpg"></div> <p>总线矩阵可实现以下部分互联：</p> <ul><li>八条主控总线：
<ul><li>Cortex-M4 内核 I 总线，D 总线和 S 总线；</li> <li>DMA1 存储器总线，DMA2 存储器总线；</li> <li>DMA2 外设总线；</li> <li>以太网DMA 纵向的；</li> <li>USB OTG HS DMA 总线；</li></ul></li> <li>七条被控总线：
<ul><li>内部FLASH ICode 总线；</li> <li>内部FLASH DCode 总线；</li> <li>主要内部SRAM1（112KB）；</li> <li>辅助内部SRAM2（16KB）；</li> <li>AHB1 外设和AHB2 外设；</li> <li>FSMC 控制器</li></ul></li></ul> <h3 id="几条总控总线"><a href="#几条总控总线" class="header-anchor">#</a> 几条总控总线</h3> <ul><li><p><strong>I 总线</strong>：</p> <p>也就是总线矩阵图中的 S0 端，此总线用于将 Cortex 内核的<strong>指令总线</strong>连接到总线矩阵</p> <ul><li>「内核通过此总线<strong>获取指令</strong>」</li> <li>访问对象：包含代码的存储器</li></ul> <p>我们知道 STM32 有三种启动方式：从 FLASH 启动、从内部 SRAM 启动、从外部 RAM 启动，这三种存储器刚好对应的就是 M0、M2 和 M6 这三条总线</p></li> <li><p><strong>D 总线</strong>：</p> <p>此总线用于将 Cortex <strong>数据总线</strong>和 64KB CCM 数据 RAM 连接到总线矩阵</p> <ul><li>「内核通过此总线进行<strong>立即数加载和调试访问</strong>」</li> <li>访问对象：代码或数据的存储器（内部FLASH 或通过FSMC 的外部存储器）</li></ul></li> <li><p><strong>S 总线</strong>：</p> <p>此总线用于将 Cortex 内核的系统总线连接到总线矩阵</p> <ul><li>「此总线用于访问位于外设或 SRAM 中的数据」也可通过此总线获取指令（效率低于 I 总
线）</li> <li>访问的对象：112KB、16KB 的内部 SRAM、包括 APB 外设在内的 AHB1
外设、AHB2 外设以及通过 FSMC 的外部存储器</li></ul></li> <li><p><strong>DMA 存储器总线</strong>：</p> <p>此总线用于将DMA 存储器总线主接口连接到总线矩阵。
DMA 通过此总线来执行存储器数据的传入和传出</p></li> <li><p><strong>DMA 外设总线</strong>：</p> <p>此总线用于将 DMA 外设主总线接口连接总线矩阵。DMA 通过此总线访问 AHB 外设或执行存储器之间的数据传输</p></li> <li><p><strong>以太网 DMA 总线</strong>：</p> <p>此总线用于将以太网 DMA 主接口连接到总线矩阵。以太网DMA 通过此总线向存储器存取数据</p></li> <li><p><strong>USB OTG HS DMA 总线</strong>：</p> <p>此总线用于将 USB OTG HS DMA 主接口连接到总线矩阵。USB OTG HS DMA 通过此总线向存储器加载/存储数据</p></li></ul> <h3 id="什么是总线矩阵"><a href="#什么是总线矩阵" class="header-anchor">#</a> 什么是总线矩阵</h3> <p>总线矩阵的功能就是<strong>访问仲裁</strong>，「总线矩阵就像是一个裁判，由他来决定某个时刻允许谁与谁通信」</p> <p>他的判断是有个方法的，叫做“轮换算法”，就是按顺序轮换，不能插队。<strong>一个时间只能有一个主动单元通过总线矩阵与一个被动单元连接</strong>。这里「主动单元是上述中 8 条主控总线，就是 CM4 内核和 DMA 控制器」，他们是控制端是有权限发出命令的主机。如果两个同时想要控制，就由总线矩阵判定当前给谁用；</p> <p>7 条被控总线属于被动单元，比如 Flash、SRAM 就是用来存放数据的，相当于电脑硬盘和内存，完全是被动，任由 CPU 控制进行数据读写。</p> <h2 id="地址映射与位带操作"><a href="#地址映射与位带操作" class="header-anchor">#</a> 地址映射与位带操作</h2> <blockquote><p>目前先简略的记一下，等到学到底层的时候再回来</p></blockquote> <h3 id="地址映射"><a href="#地址映射" class="header-anchor">#</a> 地址映射</h3> <p>由于 STM32 是一个32位的单片机，所以做一个简单的计算：<mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="9.859ex" height="2.072ex" viewBox="0 -833.9 4357.9 915.9" style="vertical-align:-0.186ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="msup"><g data-mml-node="mn"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><g data-mml-node="TeXAtom" transform="translate(500, 363) scale(0.707)"><g data-mml-node="mn"><path data-c="33" d="M127 463Q100 463 85 480T69 524Q69 579 117 622T233 665Q268 665 277 664Q351 652 390 611T430 522Q430 470 396 421T302 350L299 348Q299 347 308 345T337 336T375 315Q457 262 457 175Q457 96 395 37T238 -22Q158 -22 100 21T42 130Q42 158 60 175T105 193Q133 193 151 175T169 130Q169 119 166 110T159 94T148 82T136 74T126 70T118 67L114 66Q165 21 238 21Q293 21 321 74Q338 107 338 175V195Q338 290 274 322Q259 328 213 329L171 330L168 332Q166 335 166 348Q166 366 174 366Q202 366 232 371Q266 376 294 413T322 525V533Q322 590 287 612Q265 626 240 626Q208 626 181 615T143 592T132 580H135Q138 579 143 578T153 573T165 566T175 555T183 540T186 520Q186 498 172 481T127 463Z"></path><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z" transform="translate(500, 0)"></path></g></g></g><g data-mml-node="mo" transform="translate(1257.1, 0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mn" transform="translate(2312.9, 0)"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(2812.9, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(3598.9, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g></g></g></svg></mjx-container> ，也就是讲它能够轻松的访问到 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="4.627ex" height="1.645ex" viewBox="0 -705 2045 727" style="vertical-align:-0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(1286, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g></g></g></svg></mjx-container> 之内的数字</p> <p>所以在这 <mjx-container jax="SVG" class="MathJax"><svg xmlns="http://www.w3.org/2000/svg" width="4.627ex" height="1.645ex" viewBox="0 -705 2045 727" style="vertical-align:-0.05ex;"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="matrix(1 0 0 -1 0 0)"><g data-mml-node="math"><g data-mml-node="mn"><path data-c="34" d="M462 0Q444 3 333 3Q217 3 199 0H190V46H221Q241 46 248 46T265 48T279 53T286 61Q287 63 287 115V165H28V211L179 442Q332 674 334 675Q336 677 355 677H373L379 671V211H471V165H379V114Q379 73 379 66T385 54Q393 47 442 46H471V0H462ZM293 211V545L74 212L183 211H293Z"></path></g><g data-mml-node="mi" transform="translate(500, 0)"><path data-c="47" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q492 659 471 656T418 643T357 615T294 567T236 496T189 394T158 260Q156 242 156 221Q156 173 170 136T206 79T256 45T308 28T353 24Q407 24 452 47T514 106Q517 114 529 161T541 214Q541 222 528 224T468 227H431Q425 233 425 235T427 254Q431 267 437 273H454Q494 271 594 271Q634 271 659 271T695 272T707 272Q721 272 721 263Q721 261 719 249Q714 230 709 228Q706 227 694 227Q674 227 653 224Q646 221 643 215T629 164Q620 131 614 108Q589 6 586 3Q584 1 581 1Q571 1 553 21T530 52Q530 53 528 52T522 47Q448 -22 322 -22Q201 -22 126 55T50 252Z"></path></g><g data-mml-node="mi" transform="translate(1286, 0)"><path data-c="42" d="M231 637Q204 637 199 638T194 649Q194 676 205 682Q206 683 335 683Q594 683 608 681Q671 671 713 636T756 544Q756 480 698 429T565 360L555 357Q619 348 660 311T702 219Q702 146 630 78T453 1Q446 0 242 0Q42 0 39 2Q35 5 35 10Q35 17 37 24Q42 43 47 45Q51 46 62 46H68Q95 46 128 49Q142 52 147 61Q150 65 219 339T288 628Q288 635 231 637ZM649 544Q649 574 634 600T585 634Q578 636 493 637Q473 637 451 637T416 636H403Q388 635 384 626Q382 622 352 506Q352 503 351 500L320 374H401Q482 374 494 376Q554 386 601 434T649 544ZM595 229Q595 273 572 302T512 336Q506 337 429 337Q311 337 310 336Q310 334 293 263T258 122L240 52Q240 48 252 48T333 46Q422 46 429 47Q491 54 543 105T595 229Z"></path></g></g></g></svg></mjx-container> 的空间内，ARM 把每 512 MB 分为一个个小块，留给芯片厂商做具体的用途，而 ST 官方给 STM32 的存储器映射则可以在芯片手册中查到，将一些片内片外的设施、片外的外设分配为一个个地址，通过这些地址我们就可以方便的进行编程来控制每个部分的具体作用</p> <h3 id="位带操作"><a href="#位带操作" class="header-anchor">#</a> 位带操作</h3> <p>关于位带操作可以参考<a href="https://zhuanlan.zhihu.com/p/142586194" target="_blank" rel="noopener noreferrer">这篇文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，写的非常好了</p> <p>反正基本就是把一个外设的地址扩展为能控制详细功能的32倍的地址</p> <h2 id="时钟与复位"><a href="#时钟与复位" class="header-anchor">#</a> 时钟与复位</h2> <p>对于时钟树，CubeMX 中可以清晰地看到可以分为三个部分：第一部分是时钟的生成，第二部分是外设
时钟的配置，第三部分是主时钟输</p> <div align="center"><img src="https://cdn.jsdelivr.net/gh/CHANShu0508/images_shack/images/20200930171532.jpg"></div> <h3 id="时钟的生成"><a href="#时钟的生成" class="header-anchor">#</a> 时钟的生成</h3> <p>图中左边部分是时钟的生成功能选择，包括生成<strong>RTC(实时时间)时钟</strong>、
<strong>IWDG(独立看门狗)</strong>、<strong>FLITFCLK(闪存存储器接口)时钟</strong>、<strong>SYSCLK(系统时钟)</strong>。其中只有系统时钟是必须设置的，其他的都是与外设相关的，即有用到该外设才需要设置该时钟。</p> <p>RTC 时钟可以从 3 个时钟来源，选择一种，为得到精准的实时时间我们一般需要使用 LSE(低速时钟)，该时钟一般来源于芯片外接的 32.768KHz 的晶振。
独立看门狗只能使用芯片内的 32KHz 时钟源 LSI RC。</p> <p>系统时钟是微控制器真正运行速度快慢的体现。STM32F407 芯片支持最大的系统时钟是 168MHz（支持长时间正常运行）。系统时钟也有 3 个可选来源：</p> <ul><li>第 1
种是直接使用芯片内部的16MHz 时钟源 HSI RC，显然直接使用这个很浪费资源，本来可以跑168MHz 的，现在拿来跑16MHz，所以这种一般都不会使用</li> <li>第 2 种是直接把芯片外接的时钟源(一般是石英晶振)做为系统时钟，为得到 168MHz 的
系统时钟，我们需要外接 168MHz 的晶振，这个出于成本考虑，一般也不用</li> <li>第
3 种是把外接时钟源或者芯片内部 8MHz 时钟源的 8 分频接入到 PLL(锁相环)倍频
得到PLLCLK，然后才得到系统时钟，实际应用中一般使用这种方法，只要外接一
个8 MHz 晶振就可以得到 168MHz 的系统时钟，另外一般选择外接 8MHz 的晶振
时钟源HSE 而不会选择内部的 HIS RC，一个是出于稳定性考虑，另 外8MHz 的晶振成本也不高。</li></ul> <h3 id="外设时钟的配置"><a href="#外设时钟的配置" class="header-anchor">#</a> 外设时钟的配置</h3> <p>AHB 总线频率(HCLK)是通过 SYSCLK 分频得到的，最高支持 168MHz，所以一般选择 1 分频。I2S 外设是直接使用 HSE 分频一次后的时钟，ETH 是使用同 SYSCLK
时钟。APB1 和 APB2 总线的时钟都是由 HCLK 分频得到，其中 PCLK1(APB1 总线频率)最大只能是 84MHz，而 PCLK2(APB2 总线频率)可以达到 168MHz。从图 9-7 中
可以看到，挂在 APB1 总线上的外设有 TIM2~TIM7、TIM12~TIM14、USART2、USART3、
SPI2、SPI3、I2C1~3 等等，挂在 APB2 总线上的外设有SDIO、TIM1、TIM8、TIM9、
TIM11、USART1、USART6、ADC 等等。</p> <h3 id="主时钟的输出"><a href="#主时钟的输出" class="header-anchor">#</a> 主时钟的输出</h3> <p>STM32F40x 控制器有两个个主时钟输出引脚 MCO，第一个 MCO1 引脚（PA8）
有4个时钟源可以选择：HIS 时钟(内部高速时钟源)、LSE(外部低速时钟源)、
HSE(外部高速时钟源)、PLL 时钟</p> <p>第二个 MCO2 引脚（PC9）有 4 个时钟源可
以选择：HSE 时钟、PLL 时钟、系统时钟（SYSCLK）、PLLI2S 时钟。MCO 输出时钟最高不能超过 100MHz，因为引脚最高频率不能超过100MHz</p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/chanshu0508/wikiBase/edit/master/docs/STM32/00.基础/04.STM32的运行.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2020/10/02, 12:10:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/25d378/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">MCU的硬件运行机制</div></a> <a href="/pages/c885ad/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">一些语言&amp;调试零碎</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/25d378/" class="prev">MCU的硬件运行机制</a></span> <span class="next"><a href="/pages/c885ad/">一些语言&amp;调试零碎</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2020-2021
    <span>Jack :) | MIT License</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">跟随系统</li><li class="iconfont icon-rijianmoshi">浅色模式</li><li class="iconfont icon-yejianmoshi">深色模式</li><li class="iconfont icon-yuedu">阅读模式</li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.287ba006.js" defer></script><script src="/assets/js/2.cf4362eb.js" defer></script><script src="/assets/js/41.8cb7036a.js" defer></script>
  </body>
</html>